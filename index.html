<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>价保周期判定工具</title>
<style>
body {font-family:"Helvetica Neue",Arial,sans-serif;background:#f8f9fa;color:#333;margin:0;padding:0;}
header {display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #ddd;background:white;}
h1 {margin:0;font-weight:300;}
.lang-switch select {padding:5px 10px;font-size:1em;}
.tab-container {display:flex;border-bottom:1px solid #ddd;margin-top:10px;}
.tab {padding:10px 20px;cursor:pointer;}
.tab.active {background:#007bff;color:#fff;}
main {max-width:600px;margin:30px auto;padding:20px;background:white;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
.form-group {margin-bottom:20px;}
label {display:block;margin-bottom:8px;font-weight:500;}
input,select,button {width:100%;padding:10px;font-size:1em;border:1px solid #ccc;border-radius:6px;}
button {background:#007bff;color:white;border:none;cursor:pointer;}
button:hover {background:#0056b3;}
#result {margin-top:30px;}
#result > div {background:#f1f3f5;padding:15px;margin-bottom:10px;border-radius:6px;}
.hidden {display:none;}
</style>
</head>
<body>
<header>
  <div>
    <h1 id="header-title">价保周期判定工具</h1>
    <div class="tab-container">
      <div class="tab active" data-tab="main" id="tab-main">主功能</div>
      <div class="tab" data-tab="special" id="tab-special">特殊场景</div>
    </div>
  </div>
  <div class="lang-switch">
    <select id="language">
      <option value="zh">简体中文</option>
      <option value="en">English</option>
      <option value="zh-tw">繁體中文</option>
      <option value="ja">日本語</option>
    </select>
  </div>
</header>

<main>
  <!-- 主功能 -->
  <div id="main-content">
    <div class="form-group">
      <label for="country" id="label-country">国家/地区</label>
      <select id="country"></select>
    </div>
    
    <div class="form-group">
      <label for="channel" id="label-channel">购买渠道</label>
      <select id="channel"></select>
    </div>

    <div class="form-group">
      <label for="deliver-date" id="label-deliver-date">客户签收时间</label>
      <input type="date" id="deliver-date">
    </div>
    
    <div class="form-group">
      <label for="apply-date" id="label-apply-date">申请价保时间</label>
      <input type="date" id="apply-date">
    </div>

    <button id="calculate">判定价保周期</button>

    <section id="result" class="hidden">
      <h2 id="result-title">结果</h2>
      <div id="policy"></div>
      <div id="thought"></div>
      <div id="script"></div>
    </section>
  </div>

  <!-- 特殊场景 -->
  <div id="special-content" class="hidden">
    <div class="form-group">
      <label for="special-country" id="label-special-country">国家/地区</label>
      <select id="special-country"></select>
    </div>
    <div id="special-display">
      <!-- 特殊场景会根据语言/国家显示 -->
    </div>
  </div>
</main>

<script>
/* 配置结构：
   1. tabs: 多语言tab标题
   2. countries: 国家列表
   3. channels: 每国的购买渠道列表
   4. activity: 每国的活动时间
   5. rules: 每国周期阈值
   6. policies: 每国/渠道政策
   7. specialCases: 特殊场景不同国家的文案/说明
*/
window.priceProtectConfig = {
  zh: {
    tabs: { main: "主功能", special: "特殊场景" },
    countries: ["中国大陆", "台湾", "日本", "美国"],
    channels: {
      "中国大陆": ["线上官方商城", "其他渠道"],
      "台湾": ["线上官方商城", "其他渠道"],
      "日本": ["线上官方商城", "其他渠道"],
      "美国": ["线上官方商城", "其他渠道"]
    },
    activity: {
      "中国大陆": { start: "2024-06-01", end: "2027-06-10" },
      "台湾": { start: "2024-06-01", end: "2024-06-08" },
      "日本": { start: "2024-07-01", end: "2024-07-10" },
      "美国": { start: "2024-11-20", end: "2024-11-27" }
    },
    rules: {
      "中国大陆": { thresholds: [7, 30] },
      "台湾": { thresholds: [7, 30] },
      "日本": { thresholds: [14, 30] },
      "美国": { thresholds: [7, 30] }
    },
    policies: {
      "线上官方商城": {
within7: { 
  policy: "补 DJI币 or 退现金差价", 
  thought: `
    <div style="font-family:Arial, 'Microsoft YaHei'; line-height:1.6;">
      <strong style="color:#0066cc; font-size:1.1em;">方案二选一：</strong>
      <ol style="margin:8px 0 12px 20px; padding:0;">
        <li style="background-color:#fff3cd; padding:2px 4px; border-radius:4px;">
          提供差价对应的 <strong>DJI币</strong>
        </li>
        <li style="background-color:#d4edda; padding:2px 4px; border-radius:4px;">
          创建 CRM 案例安排仅退款退差价（<strong>现金</strong>）
        </li>
      </ol>
    </div>
  `,
  script: `

      <strong style="color:#0066cc; font-size:1.1em;">参考话术：</strong>
<div style="font-family:Arial, 'Microsoft YaHei'; line-height:1.6;">
  <p>
    尊敬的 <span style="background-color:#fff3cd;">XXX</span>，感谢您的信任，请您放心！<br>
    我们可以为您提供 <strong style="color:#17a2b8;">差价等值的 DJI币</strong> 或
    <strong style="color:#ffc107;">现金退差</strong>。<br>
    请问您倾向于 <span style="background-color:#fff3cd;">DJI币</span> 还是
    <span style="background-color:#d4edda;">现金退差</span> 呢？
  </p>

  <p style="margin:6px 0;">
    <strong>补偿DJI币：</strong> DJI币可用于购买 DJI 官方商城的任意商品（不含运费），DJI币将在订单收货后约 15 天生效。您可以届时访问  
    <a href="https://my.dji.com/credit" target="_blank" style="color:#0066cc;">查看您的DJI币余额</a> 。
  </p>

  <p style="margin:6px 0;">
    <strong>现金退差说明：</strong> 差价会在 2-7 个工作日原路退回至您的支付账户。
  </p>

  <p style="color:#6c757d; font-size:0.9em;">
    注：如后续发生退货，退货退款时将会扣除 DJI币补偿或差价部分。
  </p>
</div>
  `
},
        within30: { policy:"部分价保", thought:"第二档天内申请部分退差", script:"官方商城部分退差话术" },
        over30: { policy:"不支持价保", thought:"超过周期不支持", script:"官方商城不价保话术" },
        afterActivity:{ policy:"活动结束", thought:"活动结束不价保", script:"活动结束话术" }
      },
      "其他渠道": {
        within7: { policy:"全额价保", thought:"第一档天内申请全额退差", script:"其他渠道全额退差话术" },
        within30: { policy:"部分价保", thought:"第二档天内申请部分退差", script:"其他渠道部分退差话术" },
        over30: { policy:"不支持价保", thought:"超过周期不支持", script:"其他渠道不价保话术" },
        afterActivity:{ policy:"活动结束", thought:"活动结束不价保", script:"其他渠道活动结束话术" }
      }
    },
    specialCases: {
      "中国大陆": { title:"特殊场景说明 - 中国大陆", content:"这里是中国大陆的特殊场景说明或政策" },
      "台湾": { title:"特殊场景说明 - 台湾", content:"这里是台湾的特殊场景说明或政策" },
      "日本": { title:"特殊场景说明 - 日本", content:"这里是日本的特殊场景说明或政策" },
      "美国": { title:"特殊场景说明 - 美国", content:"这里是美国的特殊场景说明或政策" }
    }
  },
  en: {
    tabs: { main: "Main Function", special: "Special Cases" },
    countries: ["China", "Taiwan", "Japan", "USA"],
    channels: {
      "China": ["Online Official Store", "Other Channels"],
      "Taiwan": ["Online Official Store", "Other Channels"],
      "Japan": ["Online Official Store", "Other Channels"],
      "USA": ["Online Official Store", "Other Channels"]
    },
    activity: {
      "China": { start: "2024-06-01", end: "2024-06-10" },
      "Taiwan": { start: "2024-06-01", end: "2024-06-08" },
      "Japan": { start: "2024-07-01", end: "2024-07-10" },
      "USA": { start: "2024-11-20", end: "2024-11-27" }
    },
    rules: {
      "China": { thresholds: [7,30] },
      "Taiwan": { thresholds: [7,30] },
      "Japan": { thresholds: [14,30] },
      "USA": { thresholds: [7,30] }
    },
    policies: {
      "Online Official Store": {
        within7: { policy:"Full Price Protection", thought:"Within first threshold days", script:"Full refund for official store" },
        within30: { policy:"Partial Price Protection", thought:"Within second threshold days", script:"Partial refund" },
        over30: { policy:"No Price Protection", thought:"Beyond threshold", script:"No refund" },
        afterActivity:{ policy:"Event Ended", thought:"After end no protection", script:"Event ended script" }
      },
      "Other Channels": {
        within7: { policy:"Full Price Protection", thought:"Within first threshold days", script:"Full refund for other channels" },
        within30: { policy:"Partial Price Protection", thought:"Within second threshold days", script:"Partial refund for other channels" },
        over30: { policy:"No Price Protection", thought:"Beyond threshold", script:"No refund OC" },
        afterActivity:{ policy:"Event Ended", thought:"After end no protection", script:"Event ended script OC" }
      }
    },
    specialCases: {
      "China": { title:"Special Case - China", content:"Special policies for China" },
      "Taiwan": { title:"Special Case - Taiwan", content:"Special policies for Taiwan" },
      "Japan": { title:"Special Case - Japan", content:"Special policies for Japan" },
      "USA": { title:"Special Case - USA", content:"Special policies for USA" }
    }
  }
};

// 初始化和事件
document.addEventListener("DOMContentLoaded",()=>{
  const langSel=document.getElementById("language");
  const countrySel=document.getElementById("country");
  const channelSel=document.getElementById("channel");
  const deliverDate=document.getElementById("deliver-date");
  const applyDate=document.getElementById("apply-date");
  const calcBtn=document.getElementById("calculate");
  const resSection=document.getElementById("result");
  const tabs=document.querySelectorAll(".tab");
  const mainContent=document.getElementById("main-content");
  const specialContent=document.getElementById("special-content");
  const specialCountrySel=document.getElementById("special-country");
  const specialDisplay=document.getElementById("special-display");

  let lang=langSel.value;

  function loadCountries(){
    const cfg=window.priceProtectConfig[lang];
    countrySel.innerHTML="";
    cfg.countries.forEach(c=>{
      const opt=document.createElement("option");
      opt.value=c; opt.textContent=c;
      countrySel.appendChild(opt);
    });
    loadChannels();
    // 特殊场景国家
    specialCountrySel.innerHTML="";
    cfg.countries.forEach(c=>{
      const opt=document.createElement("option");
      opt.value=c; opt.textContent=c;
      specialCountrySel.appendChild(opt);
    });
    updateSpecialDisplay();
  }

  function loadChannels(){
    const cfg=window.priceProtectConfig[lang];
    const country=countrySel.value;
    const list=cfg.channels[country]||[];
    channelSel.innerHTML="";
    list.forEach(ch=>{
      const opt=document.createElement("option");
      opt.value=ch; opt.textContent=ch;
      channelSel.appendChild(opt);
    });
  }

  function updateLabels(){
    const cfg=window.priceProtectConfig[lang];
    document.getElementById("tab-main").textContent=cfg.tabs.main;
    document.getElementById("tab-special").textContent=cfg.tabs.special;
    document.getElementById("label-country").textContent="国家/地区";
    document.getElementById("label-channel").textContent="购买渠道";
    document.getElementById("label-deliver-date").textContent="客户签收时间";
    document.getElementById("label-apply-date").textContent="申请价保时间";
document.getElementById("result-title").innerHTML = 
  '具体降价明细和产品活动时间请参考：<a href="https://docs.djicorp.com/weboffice/l/shYEp8S5foirW" target="_blank" style="color:#007bff;text-decoration:underline;">https://docs.djicorp.com/weboffice/l/shYEp8S5foirW</a>';
    document.getElementById("label-special-country").textContent="国家/地区";
  }

  function updateSpecialDisplay(){
    const cfg=window.priceProtectConfig[lang];
    const scCountry=specialCountrySel.value;
    const sc=cfg.specialCases[scCountry];
    specialDisplay.innerHTML=`<h3>${sc.title}</h3><p>${sc.content}</p>`;
  }

  langSel.addEventListener("change",()=>{
    lang=langSel.value;
    loadCountries();
    updateLabels();
    resSection.classList.add("hidden");
  });

  countrySel.addEventListener("change",loadChannels);
  specialCountrySel.addEventListener("change",updateSpecialDisplay);

  calcBtn.addEventListener("click",()=>{
    const deliver=new Date(deliverDate.value);
    const apply=new Date(applyDate.value);
    if(isNaN(deliver)||isNaN(apply)){alert("请选择日期");return;}
    const diffDays=Math.floor((apply-deliver)/(1000*60*60*24));
    const cfg=window.priceProtectConfig[lang];
    const country=countrySel.value;
    const channel=channelSel.value;
    const thresholds=cfg.rules[country]?.thresholds||[7,30];
    const activityCfg=cfg.activity[country];
    let phase="";
    if(activityCfg){
      const actEnd=new Date(activityCfg.end);
      if(apply>actEnd) phase="afterActivity";
    }
    if(!phase){
      if(diffDays<=thresholds[0]) phase="within7";
      else if(diffDays<=thresholds[1]) phase="within30";
      else phase="over30";
    }
    const policy=cfg.policies[channel][phase];
    document.getElementById("policy").textContent=policy.policy;
document.getElementById("thought").innerHTML = policy.thought;
document.getElementById("script").innerHTML = policy.script;
    resSection.classList.remove("hidden");
  });

  // 切换tab
  tabs.forEach(tab=>{
    tab.addEventListener("click",()=>{
      tabs.forEach(t=>t.classList.remove("active"));
      tab.classList.add("active");
      if(tab.dataset.tab==="main"){
        mainContent.classList.remove("hidden");
        specialContent.classList.add("hidden");
      }else{
        mainContent.classList.add("hidden");
        specialContent.classList.remove("hidden");
      }
    });
  });

  loadCountries();
  updateLabels();
});
</script>
</body>
</html>